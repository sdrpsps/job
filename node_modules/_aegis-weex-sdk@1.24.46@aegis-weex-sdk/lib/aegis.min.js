/**
 *  ======================================================================
 * @tencent/aegis-weex-sdk@1.24.45 (c) 2021 Tencent Application Monitor.
 * Author pumpkincai.
 * Last Release Time Wed Dec 29 2021 23:00:35 GMT+0800 (GMT+08:00).
 * Released under the MIT License.
 * Thanks for supporting TAM & Aegis!
 * ======================================================================
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Aegis=t()}(this,function(){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},u=function(){return(u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,s,l,u){return new(l=l||Promise)(function(n,t){function i(e){try{r(u.next(e))}catch(e){t(e)}}function o(e){try{r(u.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(i,o)}r((u=u.apply(e,s||[])).next())})}function a(n,i){var o,r,s,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,r&&(s=2&t[0]?r.return:t[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,t[1])).done)return s;switch(r=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,r=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!((s=0<(s=l.trys).length&&s[s.length-1])||6!==t[0]&&2!==t[0])){l=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){l.label=t[1];break}if(6===t[0]&&l.label<s[1]){l.label=s[1],s=t;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(t);break}s[2]&&l.ops.pop(),l.trys.pop();continue}t=i.call(n,l)}catch(e){t=[6,e],r=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function c(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),o=0,t=0;t<n;t++)for(var r=arguments[t],s=0,l=r.length;s<l;s++,o++)i[o]=r[s];return i}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(i=arguments[n]))for(var i=Object(i),o=Object.keys(Object(i)),r=0,s=o.length;r<s;r++){var l=o[r],u=Object.getOwnPropertyDescriptor(i,l);null!=u&&u.enumerable&&(t[l]=i[l])}return t}});var f,i=(e.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},e.prototype.on=function(e,t,n){if(void 0===n&&(n=0),this){var i=this.eventsList[e];return(i||(this.eventsList[e]=[],i=this.eventsList[e]),-1!==this.indexOf(i,t))?this:(i.push({name:e,type:n||0,callback:t}),this)}},e.prototype.one=function(e,t){this.on(e,t,1)},e.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},e.prototype.clear=function(){this.eventsList={}},e),o=function(t){try{return encodeURIComponent(decodeURIComponent(t))}catch(e){return t}};function e(){var s=this;this.emit=function(e,t){if(s){var n;if(null!=(i=s.eventsList[e])&&i.length)for(var i=i.slice(),o=0;o<i.length;o++){n=i[o];try{var r=n.callback.apply(s,[t]);if(1===n.type&&s.remove(e,n.callback),!1===r)break}catch(e){throw e}}return s}},this.eventsList={}}(B=f=f||{})[B.number=-1]="number",B.string="";function p(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}var d,h,g,v=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/ogg","text/html","text/css","text/javascript","image","audio","video"],y=["ret","retcode","code","errcode"],r=function(e){if("string"==typeof e)return e;try{return(JSON.stringify(e,(i=[],o=[],function(e,t){if(t instanceof Error)return"Error.message: "+t.message+" \n  Error.stack: "+t.stack;if("object"==typeof t&&null!==t){var n=i.indexOf(t);if(-1!==n)return"[Circular "+o[n]+"]";i.push(t),o.push(e||"root")}return t}),4)||"undefined").replace(/"/gim,"")}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}var i,o},m=function(n,i){void 0===i&&(i=3);var o,r,s,l="";return Array.isArray(n)?(l+="[",o=n.length,n.forEach(function(e,t){l+="object"==typeof e&&1<i?m(e,i-1):O(e),l+=t===o-1?"":","}),l+="]"):n instanceof Object?(l="{",r=Object.keys(n),s=r.length,r.forEach(function(e,t){"object"==typeof n[e]&&1<i?l+='"'+e+'":'+m(n[e],i-1):l+=b(e,n[e]),l+=t===s-1||t<s-1&&void 0===n[r[t+1]]?"":","}),l+="}"):l+=n,l},b=function(e,t){var n=typeof t,i="";return"string"==n||"object"==n?i+='"'+e+'":"'+t+'"':"function"==typeof t?i+='"'+e+'":"function '+t.name+'"':"symbol"==typeof t?i+='"'+e+'":"symbol"':"number"!=typeof t&&"boolean"!=n||(i+='"'+e+'": '+t),i},O=function(e){var t=typeof e;return""+("undefined"==t||"symbol"==t||"function"==t?"null":"string"==t||"object"==t?'"'+e+'"':e)},w=(t.prototype.sourceURL=function(){return this.data.url},t.prototype.status=function(){return Number(this.data.status)},t.prototype.headers=function(){var n={};return this.data.headers.forEach(function(e,t){n[t]=e}),n},t);function t(e,t){this.type="fetch",this.data=e||{},this.data.response=t}(j=d=d||{}).INFO_ALL="-1",j.API_RESPONSE="1",j.INFO="2",j.ERROR="4",j.PROMISE_ERROR="8",j.AJAX_ERROR="16",j.SCRIPT_ERROR="32",j.IMAGE_ERROR="64",j.CSS_ERROR="128",j.CONSOLE_ERROR="256",j.MEDIA_ERROR="512",j.RET_ERROR="1024",j.REPORT="2048",j.PV="4096",j.EVENT="8192",j.PAGE_NOT_FOUND_ERROR="16384",(M={})[M.android=1]="android",M[M.ios=2]="ios",M[M.windows=3]="windows",M[M.macos=4]="macos",M[M.linux=5]="linux",M[M.devtools=6]="devtools",M[M.other=100]="other",(V={})[V.unknown=100]="unknown",V[V.wifi=1]="wifi",V[V.net2g=2]="net2g",V[V.net3g=3]="net3g",V[V.net4g=4]="net4g",V[V.net5g=5]="net5g",V[V.net6g=6]="net6g",(B=h=h||{}).LOG="log",B.SPEED="speed",B.PERFORMANCE="performance",B.OFFLINE="offline",B.WHITE_LIST="whiteList",B.VITALS="vitals",B.PV="pv",B.CUSTOM_PV="customPV",B.EVENT="event",B.CUSTOM="custom",B.SDK_ERROR="sdkError",B.SET_DATA="setData",(j=g=g||{}).production="production",j.gray="gray",j.pre="pre",j.daily="daily",j.local="local",j.test="test",j.others="others";function l(e){return e.filter(function(n,i){return"static"!==n.type||!e.find(function(e,t){return i!==t&&n.url===e.url&&200===n.status})})}function x(e){e.level===d.INFO_ALL&&(e.level=d.INFO)}function R(o){return function(e,t){o.lifeCycle.emit("modifyRequest",e);var n=o.config.modifyRequest;if("function"==typeof n)try{var i=n(e);"object"==typeof i&&"url"in i&&(e=i)}catch(e){console.error(e)}t(e)}}function E(i){return function(e,t){i.lifeCycle.emit("afterRequest",e);var n=i.config.afterRequest;"function"==typeof n&&!1===n(e)||t(e)}}function P(){}function L(t,n){Object.getOwnPropertyNames(t).forEach(function(e){"function"==typeof t[e]&&"constructor"!==e&&(n?n[e]="sendPipeline"===e?function(){return function(){}}:function(){}:t[e]=function(){})})}function T(n){var t,e=this,i=(r=n.config).uin,o=r.id,r=r.offlineLogLimit;i&&o&&(t=new G({limit:void 0===r?2e4:r}),n.lifeCycle.on("beforeWrite",function(e){t.save2Offline(e=void 0===e?[]:e,n.config)}),n.getOfflineLog=function(){var e=t.getLogs({uin:i,id:o});return t.clearLogs(),e},n.uploadOfflineLogs=function(t){return s(e,void 0,void 0,function(){return a(this,function(e){return t=Array.isArray(t)?t:[t],[2,H(n,t)]})})})}var S,C,j,U=function(i,o){return function(e,t){var n=o.logCreated;if("function"!=typeof n)return i("beforeWrite",e),t(e);e=e.filter(function(e){return!1!==n(e)});return i("beforeWrite",e),t(e)}},A=function(e,n){var i,o=[],r=e.config;return e.lifeCycle.on("destroy",function(){o.length=0}),function(e,t){if(o.push(e),n&&o.length>=n)return o=l(o),t(o.splice(0,o.length)),void(i&&clearTimeout(i));i&&clearTimeout(i),i=setTimeout(function(){i=null,0<(o=l(o)).length&&t(o.splice(0,o.length))},r.delay)}},I=function(e,t){return Array.isArray(e)?t(e.map(function(e){return u(u({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(r).join(" ")})})):t(u(u({},e),{msg:"string"==typeof e.msg?e.msg:r(e.msg)}))},_=function(s){var e,l=!1,u=!1,t=!1,a=[];return s.lifeCycle.on("onConfigChange",function(){e&&clearTimeout(e),e=setTimeout(function(){var e,n;!t&&s.config&&(t=!0,e=s.config.whiteListUrl,(n=void 0===e?"":e)&&s.sendPipeline([function(e,t){t({url:n,type:h.WHITE_LIST,success:function(e){u=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,i=t.result,o=void 0===i?{}:i;if(0===n){if(l=o.is_in_white_list,s.isWhiteList=l,o.shutdown)return void s.destroy();0<=o.rate&&o.rate<=1&&(s.config.random=o.rate,s.isGetSample=!1)}s.isWhiteList&&a.length?F(s)(a.splice(0),function(){}):!s.isWhiteList&&a.length&&(a.length=0);var r=s.config.onWhitelist;"function"==typeof r&&r(l)}catch(e){}},fail:function(e){"403 forbidden"===e&&s.destroy(),u=!0}})}],h.WHITE_LIST)(null),t=!1)},s.config.uin?50:500)}),s.lifeCycle.on("destroy",function(){a.length=0}),function(e,t){var n;l||null!==(n=null===(n=s.config)||void 0===n?void 0:n.api)&&void 0!==n&&n.reportRequest?t(e.concat(a.splice(0)).map(function(e){return x(e),e})):(e=e.filter(function(e){return e.level!==d.INFO&&e.level!==d.API_RESPONSE?(x(e),!0):(u||(a.push(e),200<=a.length&&(a.length=200)),!1)})).length&&t(e)}},N=function(i){return setTimeout(function(){var e=i.config.pvUrl,n=void 0===e?"":e;n&&i.sendPipeline([function(e,t){t({url:n,type:h.PV,fail:function(e){"403 forbidden"===e&&i.destroy()}})}],h.PV)(null)},100),function(e,t){t(e)}},k=function(o){var r={};return function(e,t){var n,i;o.speedSample?(i="object"==typeof o.repeat?o.repeat:{repeat:o.repeat},n=+i.speed||+i.repeat||5,Array.isArray(e)?(i=e.filter(function(e){var t=!r[e.url]||r[e.url]<n;return r[e.url]=1+~~r[e.url],t})).length&&t(i):(!r[e.url]||r[e.url]<n)&&(r[e.url]=1+~~r[e.url],t(e))):t(e)}},D=function(i){var o={};return function(e,t){var n="number"==typeof i.repeat?i.repeat:5;if(0===n)return t(e);t(e.filter(function(e){return e.level!==d.ERROR&&e.level!==d.PROMISE_ERROR&&e.level!==d.AJAX_ERROR&&e.level!==d.SCRIPT_ERROR&&e.level!==d.IMAGE_ERROR&&e.level!==d.CSS_ERROR&&e.level!==d.MEDIA_ERROR||(o[e.msg]=o[e.msg]||0,o[e.msg]+=1,!(o[e.msg]>n))}))}},F=function(i){return function(e){return i.sendPipeline([function(e,n){return n({url:i.config.url||"",data:(t=e,(t=Array.isArray(t)?t:[t]).map(function(t,n){return Object.getOwnPropertyNames(t).map(function(e){return o(e)+"["+n+"]="+(void 0===t[e]?"":o(t[e]))}).join("&")}).join("&")+(t.length?"&count="+t.length:"")),method:"post",contentType:"application/x-www-form-urlencoded",type:h.LOG,log:e,requestConfig:{timeout:5e3},success:function(){var t=i.config.onReport;"function"==typeof t&&e.forEach(function(e){t(e)}),"function"==typeof n&&n([])},fail:function(e){"403 forbidden"===e&&i.destroy()}});var t}],h.LOG)(e)}},q=function(n){if(!n||!n.reduce||!n.length)throw new TypeError("createPipeline need at least one function param");return 1===n.length?function(e,t){n[0](e,t||P)}:n.reduce(function(n,i){return function(e,t){return void 0===t&&(t=P),n(e,function(e){return null==i?void 0:i(e,t)})}})},M=(Object.defineProperty(te.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.24.45"},enumerable:!1,configurable:!0}),Object.defineProperty(te.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),d},enumerable:!1,configurable:!0}),te.prototype.init=function(e){this.setConfig(e);for(var t=0;t<te.installedPlugins.length;t++)try{te.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},te.prototype.setConfig=function(e){Object.assign(this.config,e);var t=this.config,n=t.id,i=t.uin,o=t.version,r=t.ext1,s=t.ext2,l=t.ext3,e=t.aid,t=t.env,u=void 0===t?"production":t,t=this.bean.id!==n||this.bean.uin!==i||this.bean.aid!==e;return this.bean.id=n||"",this.bean.uin=i||"",this.bean.version=o||"1.24.45",this.bean.aid=e||"",this.bean.env=function(){switch(u){case g.production:case g.gray:case g.pre:case g.daily:case g.local:case g.others:return 1;default:return}}()?u:g.others,r&&(this.bean.ext1=encodeURIComponent(r)),s&&(this.bean.ext2=encodeURIComponent(s)),l&&(this.bean.ext3=encodeURIComponent(l)),t&&this.lifeCycle.emit("onConfigChange",this.config),this.config},te.use=function(e){-1===te.installedPlugins.indexOf(e)&&e.aegisPlugin&&te.installedPlugins.push(e)},te.unuse=function(e){e=te.installedPlugins.indexOf(e);-1!==e&&te.installedPlugins.splice(e,1)},te.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:d.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,u({},e[0]),{level:d.INFO}),this.normalLogPipeline(n)},te.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:d.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,u({},e[0]),{level:d.INFO_ALL}),this.normalLogPipeline(n)},te.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:d.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,u({},e[0])),this.normalLogPipeline(n)},te.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:d.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,u({},e[0]),{level:d.ERROR}),this.normalLogPipeline(n)},te.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},te.prototype.reportPv=function(n){var i,o=this;n&&(console.warn("reportPv is deprecated, please use reportEvent"),i=""+Object.getOwnPropertyNames(this.bean).filter(function(e){return"id"!==e}).map(function(e){return e+"="+o.bean[e]}).join("&"),this.sendPipeline([function(e,t){t({url:o.config.url+"/"+n+"?"+i,addBean:!1,type:h.CUSTOM_PV,fail:function(e){"403 forbidden"===e&&o.destroy()}})}],h.CUSTOM_PV)(null))},te.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},te.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},te.prototype.reportT=function(e){var t=e.name,n=e.duration,i=e.ext1,o=void 0===i?"":i,r=e.ext2,i=void 0===r?"":r,r=e.ext3,r=void 0===r?"":r,e=e.from;if("string"==typeof t&&"number"==typeof n&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},te.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},te.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},te.prototype.submitCustomTime=function(e,t,n,i,o,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:i||this.config.ext2,ext3:o||this.config.ext3,from:r||void 0})},te.prototype.extendBean=function(e,t){this.bean[e]=t},te.prototype.sendPipeline=function(e,t){var n,r,s,l=this;return q(c([function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),!n.isHidden||!n.isGetSample)if(n.isGetSample)n.isHidden||t(e);else{if(n.isGetSample=!0,Math.random()<n.config.random)return n.isHidden=!1,t(e);n.isHidden=!0}},(s=t,function(e,t){var n=Array.isArray(e),i=n?e:[e];r.lifeCycle.emit("beforeRequest",e);var o=r.config.beforeRequest;(i="function"==typeof o?i.map(function(e){try{var t=o({logs:e,logType:s});return(null==t?void 0:t.logType)===s&&null!=t&&t.logs?t.logs:!1!==t&&e}catch(t){return e}}).filter(function(e){return!1!==e}):i).length&&(i=function(e,t){if(!Array.isArray(e)||e.length<=1)return e;var n=[],i=[];return!(i="string"==typeof t?[t]:t)||i.length<=0||(i.forEach(function(t){e.forEach(function(e){null!=e&&e[t]&&n.push(t)})}),0<n.length&&(e=e.map(function(e){var t={};return n.forEach(function(e){t[e]=""}),u(u({},t),e)}))),e}(i,["ext1","ext2","ext3"]),t(n?i:i[0]))})],e,[R(r=n=this),function(i,o){l.request(i,function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];o({isErr:!1,result:t,logType:null==i?void 0:i.type,logs:null==i?void 0:i.log}),null===(e=null==i?void 0:i.success)||void 0===e||e.call.apply(e,c([i],t))},function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];o({isErr:!0,result:t,logType:null==i?void 0:i.type,logs:null==i?void 0:i.log}),null===(e=null==i?void 0:i.fail)||void 0===e||e.call.apply(e,c([i],t))})},E(this)]))},te.prototype.send=function(e,o,r){var t=this;return q([R(this),function(n,i){t.request(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i({isErr:!1,result:e,logType:n.type,logs:n.log}),null==o||o.apply(void 0,e)},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i({isErr:!0,result:e,logType:n.type,logs:n.log}),null==r||r.apply(void 0,e)})},E(this)])(e)},te.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},te.prototype.sendSDKError=function(e){var n=this;this.sendPipeline([function(e,t){t({url:n.config.url+"?id=1085&msg[0]="+encodeURIComponent(r(e))+"&level[0]=2&from="+n.config.id+"&count=1&version="+n.config.id+"(1.24.45)",addBean:!1,method:"get",type:h.SDK_ERROR,log:e})}],h.SDK_ERROR)(e)},te.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,i=te.instances.indexOf(this);-1!==i&&te.instances.splice(i,1);for(var o=te.installedPlugins.length-1;0<=o;o--)try{te.installedPlugins[o].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach(function(e){n[e].writable&&(t[e]=null)}),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&L(r,this),r=Object.getPrototypeOf(r););0===te.instances.length&&(e=Object.getPrototypeOf(this).constructor,L(e),L(te))}},te.version="1.24.45",te.instances=[],te.logType=d,te.environment=g,te.installedPlugins=[],te),V=(ee.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},ee.prototype.unpatch=function(e){e=this.instances.indexOf(e);-1!==e&&this.instances.splice(e,1)},ee.prototype.countInstance=function(){return this.instances.length},ee.prototype.uninstall=function(){var e;null===(e=null===(e=this.option)||void 0===e?void 0:e.destroy)||void 0===e||e.apply(this)},ee.prototype.walk=function(n){var i=this;this.instances.forEach(function(e){var t=i.canUse(e);t&&n(e,t)})},ee.prototype.canUse=function(e){e=this.getConfig(e);return!(!e||"object"!=typeof e)||!!e},ee.prototype.getConfig=function(e){return null===(e=e.config)||void 0===e?void 0:e[this.name]},ee.prototype.exist=function(e){return-1===this.instances.indexOf(e)},ee.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null===(t=null===(t=this.option)||void 0===t?void 0:t.init)||void 0===t||t.call(this.option,this.getConfig(e)))},ee.prototype.triggerOnNewAegis=function(e){var t;null===(t=null===(t=this.option)||void 0===t?void 0:t.onNewAegis)||void 0===t||t.call(this.option,e,this.getConfig(e))},ee),H=function(l,u){return s(this,void 0,void 0,function(){var t,n,i,o,r,s;return a(this,function(e){return t=l.config,r=l.bean,n=t.offlineUrl,i=t.id,o=t.uin,r=(r||{}).aid,s=void 0===r?"":r,(o||s)&&i&&l.send({url:n+"/offlineAuto",type:h.OFFLINE,log:h.OFFLINE},function(e){e=(null==e?void 0:e.data).secretKey;if(e)try{l.send({url:n+"/offlineLog",data:{logs:u,secretKey:e,id:i,uin:o,aid:s},contentType:"application/json",method:"post",type:h.OFFLINE,log:h.OFFLINE})}catch(e){console.error(e)}},function(e){console.error(e)}),[2]})})},G=function(e){var i=this,e=(void 0===e?{}:e).limit,e=void 0===e?2e4:e;this.offlineBuffer=[],this.clearLogs=function(){i.offlineBuffer=[]},this.save2Offline=function(e,t){e=(e=Array.isArray(e)?e:[e]).map(function(e){return"string"==typeof e&&(e={msg:e}),Object.assign({id:t.id,uin:t.uin,time:+Date.now(),version:t.version},e)});i.offlineBuffer=i.offlineBuffer.concat(e).slice(0,i.limitSize)},this.getLogs=function(t,e){var n=i.offlineBuffer.filter(function(e){return e.id===t.id&&e.uin===t.uin});return null==e||e(n),n},this.limitSize=e},J=new V({name:"offlineLog",onNewAegis:function(t){T(t),t.lifeCycle.on("onConfigChange",function(e){T(t)})}}),B="undefined"!=typeof weex&&(null===weex||void 0===weex?void 0:weex.requireModule("stream")),W=null==B?void 0:B.fetch,K=function(e){var t=e.ok,n=e.status,i=e.statusText,o=e.data,r=e.headers;return{ok:t,status:n,statusText:i,body:o,headers:r,clone:function(){return K(e)},text:function(){return new Promise(function(e){return e(o)})},json:function(){return new Promise(function(e,t){try{e(JSON.parse(o))}catch(e){t(new Error("response body is not JSON"))}})}}},$=function(e,i){return void 0===i&&(i={}),new Promise(function(t,n){W||n(new Error("no available fetch found!"));try{W(u(u({},i),{url:e,type:"text"}),function(e){return t(K(e))})}catch(e){n(e)}})},X=[],z={},Y=weex,B=(n(C=Q,j=S=M),C.prototype=null===j?Object.create(j):(Z.prototype=j.prototype,new Z),Q.prototype.getPlatform=function(){var e=((null===(e=null===(e=null===(e=this.weex)||void 0===e?void 0:e.config)||void 0===e?void 0:e.env)||void 0===e?void 0:e.osName)||"").toLowerCase();return"android"===e?1:"ios"===e?2:100},Q.prototype.initOfflineLog=function(){Q.use(J)},Object.defineProperty(Q.prototype,"getBean",{get:function(){var t=this;return Object.getOwnPropertyNames(this.bean).map(function(e){return e+"="+t.bean[e]}).join("&")},enumerable:!1,configurable:!0}),Q.prototype.reportSpeed=function(e){var t,n,i,o,r;this.send({url:""+this.config.speedUrl,method:"post",data:(t=e,n=this.bean,o={fetch:[],static:[]},r={},Array.isArray(t)?t.forEach(function(e){var t;null===(t=o[e.type])||void 0===t||t.push(e)}):null===(i=o[t.type])||void 0===i||i.push(t),r.payload=JSON.stringify(u({duration:o},n)),r),contentType:"application/json",type:h.SPEED,log:e})},Q.prototype.retcode=function(e){var t=this;"object"==typeof e?e.url?400<=Object.keys(z).length||(z[e.url]||(z[e.url]=0),z[e.url]+=1,3<z[e.url])||(e=Object.assign({},{url:"",isHttps:!0,method:"GET",type:"fetch",duration:0,ret:0,status:200},e),X.push(e),1===X.length&&setTimeout(function(){t.reportSpeed(X),X=[]},1e3)):console.error("param url can not be empty!"):console.error("retcode params should be an objcet")},Q.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},Q.prototype.getOfflineLog=function(){},Q.prototype.uploadOfflineLogs=function(e){},Q.sessionID="session-"+Date.now(),Q),M=new V({name:"aid",onNewAegis:function(t){var e,n=this;this.aid&&!0!==this.aid?(t.bean.aid=this.aid,t.config.aid=this.aid):e=setTimeout(function(){n.getAid(function(e){n.aid=e,t.bean.aid=n.aid,t.config.aid=n.aid}),clearTimeout(e)},0)},getAid:function(n){return s(this,void 0,void 0,function(){var t;return a(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,localStorage.getItem("AEGIS_ID")];case 1:return(t=e.sent())||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),localStorage.setItem("AEGIS_ID",t)),null==n||n(t||""),[3,3];case 2:return e.sent(),null==n||n(""),[3,3];case 3:return[2]}})})}}),j=new V({name:"onError",listening:!1,init:function(){this.startListen()},startListen:function(){var t=this;if(!this.listening){this.listening=!0;try{var e=Vue;if(void 0===e||!e)return;var n=e.config.errorHandler;e.config.errorHandler=function(e){e&&t.publishErrorLog({msg:e,level:d.ERROR}),"function"==typeof n&&n(e)}}catch(t){this.publishErrorLog({msg:t,level:d.ERROR})}}},publishErrorLog:function(t){this.$walk(function(e){e.normalLogPipeline(t)})}}),V=new V({name:"reportApiSpeed",override:!1,fetch:null,weexFetch:null,onNewAegis:function(e){var t,n;this.override||(this.override=!0,this.fetch=e.fetch,this.weexFetch=e.weexFetch,t=(n=this.overrideFetch(e.config)).fetch,n=n.weexFetch,e.fetch=t,e.weexFetch=n)},publishSpeed:function(t){this.$walk(function(e){e.speedLogPipeline(t)})},publishNormalLog:function(t){this.$walk(function(e){e.normalLogPipeline(t)})},overrideFetch:function(a){var c=this;if("function"==typeof this.fetch){var e=this.fetch,t=this.weexFetch,l=function(o,r,s,l){var e,u,t,n,i;a.hostUrl&&-1<s.indexOf(a.hostUrl)||(u={url:s,isHttps:p(s),method:(null==l?void 0:l.method)||"get",duration:r,type:"fetch",status:o.status},"fetch"!==(n="function"==typeof(null===(e=a.api)||void 0===e?void 0:e.resourceTypeHandler)?null===(e=a.api)||void 0===e?void 0:e.resourceTypeHandler(o.url):n)&&"static"!==n&&(t="",o.headers&&(t=o.headers["Content-Type"]||o.headers["content-type"]),n=o.ok&&"string"==typeof t&&(i=t,v.some(function(e){return-1!==i.indexOf(e)}))?"static":"fetch"),"fetch"===n?o.clone().text().then(function(e){var t=null===(i=a.api)||void 0===i?void 0:i.apiDetail,n=function(e,t,n){var i;try{if("function"==typeof(null==t?void 0:t.retCodeHandler)){var o=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx)||{};return{code:void 0===(r=o.code)?"unknown":r,isErr:o.isErr}}"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null===(i=null==t?void 0:t.ret)||void 0===i?void 0:i.join)&&(y=[].concat(t.ret.map(function(e){return e.toLowerCase()})));var r,s=Object.getOwnPropertyNames(e).filter(function(e){return-1!==y.indexOf(e.toLowerCase())});return s.length?{code:""+(r=Number(e[s[0]])),isErr:0!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}(e,a.api,{url:o.url,ctx:o})||{},i=n.code,n=n.isErr,t="req url: "+s+" \n                              \nreq method: "+((null==l?void 0:l.method)||"get")+" \n                              \nreq param: "+(t?m(null==l?void 0:l.body):"")+" \n                              \nres duration: "+r+" \n                              \nres status: "+(o.status||0)+"\n                              \nres retcode: "+i+"\n                              \nres data: "+(t?e:"");c.publishNormalLog({msg:t,level:d.API_RESPONSE}),u.payload=new w(o,e),u.ret=i,u.isErr=+n,n&&c.publishNormalLog({msg:t,level:d.RET_ERROR})}):Object.assign(u,{type:"static",urlQuery:(t=o.url,n=!0,"string"==typeof t?t.split("?")[n?1:0]||"":t),domainLookup:f.number,connectTime:f.number}),c.publishSpeed(u))},n=function(e,t,n,i){if(a.hostUrl&&-1<n.indexOf(a.hostUrl))throw e;var o={url:n,isHttps:p(n),method:(null==i?void 0:i.method)||"get",duration:t,type:"fetch",status:0};c.publishSpeed(o);o=null===(o=a.api)||void 0===o?void 0:o.apiDetail,i="AJAX_ERROR: "+e+"\n              \nres status: 0\n              \nres duration: "+t+"\n              \nreq url: "+n+"\n              \nreq method: "+((null==i?void 0:i.method)||"get")+"\n              \nreq param: "+(o?m(null==i?void 0:i.body):"");throw c.publishNormalLog({msg:i,level:d.AJAX_ERROR}),e};return{fetch:function(i,o){var r=Date.now();return e(i,o).then(function(e){var t=Date.now()-r,n=e;try{l(n,t,i,o)}catch(e){}return e}).catch(function(e){var t=Date.now()-r;try{n(e,t,i,o)}catch(e){}throw e})},weexFetch:function(i,o,e){var r=i.url,s=Date.now();try{t(i,function(e){var t=Date.now()-s,n=K(e);try{l(n,t,r,i)}catch(e){}"function"==typeof o&&o(e)},e)}catch(o){e=Date.now()-s;try{n(o,e,r,i)}catch(i){}throw o}}}}}});function Q(e){var t,n,s=S.call(this,e)||this;s.weex=Y,s.originRequest=$,s.fetch=$,s.weexFetch=W,s.speedLogPipeline=q([k(s.config),A(s),function(e,t){s.lifeCycle.emit("beforeReportSpeed",e);var n=s.config.beforeReportSpeed;if((e="function"==typeof n?e.filter(function(e){return!1!==n(e)}):e).length)return t(e)},function(e){s.reportSpeed(e)}]),s.request=function(i,o,r){var e;i&&"string"==typeof i.url&&""!==i.url&&s.bean.id&&(e=i.url,!1!==i.addBean&&(e=e+(-1===e.indexOf("?")?"?":"&")+s.getBean),("get"===(i.method||"get").toLocaleLowerCase()?s.originRequest(function(e,n){if("string"!=typeof e)return"";if("object"==typeof n&&n){var t=Object.getOwnPropertyNames(n).map(function(e){var t=n[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))}).join("&").replace(/eval/gi,"evaI");return e+(-1===e.indexOf("?")?"?":"&")+t}return e}(e,i.data),u({method:"GET",headers:{}},i.requestConfig)):("string"==typeof i.data?i.data=i.data.replace(/eval/gi,"evaI"):i.data=JSON.stringify(i.data),s.originRequest(e,u({method:"POST",body:i.data,headers:i.contentType?{"Content-Type":i.contentType}:{}},i.requestConfig)))).then(function(e){var t,n;String(e.status).match(/^20\d+/g)?null==o||o(e):null==r||r(e),null===(n=(t=s.config).reqCallback)||void 0===n||n.call(t,e,i)}).catch(function(e){null==r||r(e)}))};try{e.offlineLog&&s.initOfflineLog(),s.init(e),s.extendBean("sessionId",Q.sessionID),s.extendBean("platform",s.getPlatform()),s.extendBean("from",encodeURIComponent(e.pageUrl||(null===(n=null===(t=s.weex)||void 0===t?void 0:t.config)||void 0===n?void 0:n.bundleUrl)||"")),s.extendBean("referer",encodeURIComponent(e.referrer||""))}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact aegis-helper for feedback and thank you for your support.","color: red"),s.sendSDKError(e)}return s}function Z(){this.constructor=C}function ee(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function te(e){var n,t,o=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,hostUrl:"https://aegis.qq.com",env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:""},this.isWhiteList=!1,this.lifeCycle=new i,this.bean={},this.normalLogPipeline=q([A(this,5),I,function(e,t){var i=n.config;t(e=e.map(function(e){var t,n=i.maxLength||204800;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null===(t=e.msg)||void 0===t?void 0:t.substring(0,n)}catch(t){e.msg=r(e.msg).substring(0,i.maxLength)}return e}))},D((n=this).config),U(this.lifeCycle.emit,this.config),N(this),_(this),function(e,t){var n=JSON.parse(JSON.stringify(e));o.lifeCycle.emit("beforeReport",n);var i=o.config.beforeReport;(e="function"==typeof i?e.filter(function(e){return!1!==i(e)}):e).length&&t(e)},F(this)]),this.eventPipeline=q([A(this,5),function(e){o.sendPipeline([function(e,t){var n=e.map(function(e){return{name:e.name,ext1:e.ext1||o.config.ext1||"",ext2:e.ext2||o.config.ext2||"",ext3:e.ext3||o.config.ext3||""}});t({url:o.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(n)),type:h.EVENT,log:e,fail:function(e){"403 forbidden"===e&&o.destroy()}})}],h.EVENT)(e)}]),this.timeMap={},this.customTimePipeline=q([A(this,5),function(e){return o.sendPipeline([function(e,t){t({url:o.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:h.CUSTOM,log:e,fail:function(e){"403 forbidden"===e&&o.destroy()}})}],h.CUSTOM)(e)}]),this.config=(t=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),t.url=t.url||e+"/collect",t.offlineUrl=t.offlineUrl||e+"/offline",t.whiteListUrl=t.whiteListUrl||e+"/collect/whitelist",t.pvUrl=t.pvUrl||e+"/collect/pv",t.eventUrl=t.eventUrl||e+"/collect/events",t.speedUrl=t.speedUrl||e+"/speed",t.customTimeUrl=t.customTimeUrl||e+"/speed/custom",t.performanceUrl=t.performanceUrl||e+"/speed/performance",t.webVitalsUrl=t.webVitalsUrl||e+"/speed/webvitals",t.setDataReportUrl=t.SetDataReportUrl||e+"/speed/miniProgramData",t),te.instances.push(this)}return B.use(j),B.use(V),B.use(M),B});
